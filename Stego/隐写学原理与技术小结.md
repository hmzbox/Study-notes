
## 第2章 图像编码与基本嵌入方法
---
### 2.1 RGB、YUV和YC<sub>b</sub>C<sub>r</sub>空域图像编码格式

**RGB(模型)**：RGB888是依据人眼识别的颜色定义出的空间。它的细节难以进行数字化的调整。

RGB的取值范围为：[0,255]、[0,255]、[0,255]

**YUV(模型)**: 
YUV的取值范围为：[0,255]、[负整数,正整数]、[负整数,正整数]
1. 相对于RGB，将亮度和色度分离开，从而适合于图像处理领域
2. 相对于RGB，兼容彩色电视与黑白电视问题，只有Y则是灰度图像。

**Y**表示**亮度(Luminance component/Luma)** Y = 0.299R + 0.587G + 0.114B，只有Y信号=**灰度图像**

**U、V**用来表示**色度(Chrominace/chroma)**，**U、V**是构成彩色的两个分量。

此时，我们设 U = 0.492(B - Y)，V=0.877(R-Y) 则可以求得：

U = - 0.147R- 0.289G + 0.436B　　V = 0.615R - 0.515G - 0.100B
即：

![](https://github.com/hmzbox/Study-notes/blob/master/Stego/images/YUV%20mode.png)

**YC<sub>b</sub>C<sub>r</sub>**: 为了统一YUV模型的取值范围为[0,255]

![](https://github.com/hmzbox/Study-notes/blob/master/Stego/images/YCbCr.png)


### 总结2.1：YUV色彩模型来源于RGB模型，YCbCr模型来源于YUV模型，还未涉及压缩，压缩是JPEG通过YUV411或YUV422**采样**实现。YUV为分离亮度和色度，及实现黑白彩色电视兼容提出，YCbCr为改变YUV取值范围为[0,255]
---
### 2.2 JPEG 变换域图像编码流程
**有损压缩**

因人眼对亮度变换的敏感度要比对色彩变换的敏感度高出很多，所以，可以认为Y分量要比C<sub>b</sub>和C<sub>r</sub>分量重要的多。

通常采用两种采样方式：YUV411和YUV422，它们所代表的意义是Y,C<sub>b</sub>和C<sub>r</sub>三个分量的数据取样比例一般是4：1：1或者4：2：2（在2x2的单元中，本应分别有4个Y，4个U，4个V值，用**12**个字节存储。经4:1:1采样处理后，每个单元中的值分别有4个Y、1个U、1个V，只用**6**个字节。

![](https://github.com/hmzbox/Study-notes/blob/master/Stego/images/JPEG.png)

1. **YC<sub>b</sub>C<sub>r</sub>格式输入**。若输入不是YC<sub>b</sub>C<sub>r</sub>格式，则转换成YC<sub>b</sub>C<sub>r</sub>;
2. **图像切分成8×8和采样**。若H和W不是8的倍数，则需要扩充到8的倍数（Y通常是嵌入域），并对C<sub>b</sub>和C<sub>r</sub>进行YUV411或YUV422采样；（例如16×16的块，包含4个Y分块和1个C<sub>b</sub>和1个C<sub>r</sub>）
3. **DCT II变换**。将输入分块均-128,范围 [0,255] 到 [-128,127] 以满足DCT输入条件（偶函数）；每个8×8分块都通过DCT II变换得到8×8的浮点数DCT系数矩阵 M<sub>dct</sub>（最左上角的点为直流系数DC，其余为交流系数AC）。
4. **量化**=M<sub>dct</sub> / Q<sub>i</sub>，然后取整。通过质量因子QF(如80)选取8×8的量化表 Q<sub>i</sub>，QF的取值范围为（70-100）（新的量化后矩阵就会出现很多0）
5. **无损压缩**。64个DCT矩阵排成一维序列，**DC部分**采用差分编码（DPCM）只记录相邻块的DC系数差，**AC系数部分**采用游程编码RLEC，最后将DPCM和RLEC进行熵编码，也就是哈夫曼编码(Huffman),最后加上头文件。
---
### 2.3 二元嵌入 LSBR（least significant bit replacement）与三元嵌入LSBM（LSB matching）

#### 二元嵌入LSBR
* **应用**：**Jsteg**隐写软件，在JPEG量化DCT系数采用LSBR
* **原理**：**奇小偶大**，替换最小bit位，最小位若是0（**偶数**）变1（**+1**），最小位若是1（**奇数**）变0（**-1**）
* **缺陷**：**值对**现象出现，使得相邻像素的值接近，如：2i与2i+1趋于相等，如图：
![](https://github.com/hmzbox/Study-notes/blob/master/Stego/images/LSBRHistogram.png)
* **优势**：在JPEG量化系数-1、0、1不适用，通常最小值对是2与3、是-2与-3，**奇小偶大**可以使得1与2、-1与-2是最小值对，从分利用了分布较密的1与-1。
#### 三元嵌入LSBM

* **提出原因**：解决LSBR值对问题
* **原理**：![](https://github.com/hmzbox/Study-notes/blob/master/Stego/images/LSBM.png)

如：2=(010)<sub>2</sub>，**if** s=0，(010)<sub>2</sub>不变；**if** s=1，(010)<sub>2</sub>+1=(011)<sub>2</sub>=3 or (010)<sub>2</sub>-1=(001)<sub>2</sub>=1
* **性能分析**：![](https://github.com/hmzbox/Study-notes/blob/master/Stego/images/LSBMHistogram.png)

### 总结2.3：三元嵌入LSBM解决二元嵌入LSBR值对问题，提高安全性。
---
### 2.4 调色板隐写

#### 基于亮度排序的调色板
* **应用**：**EzStego**亮度排序调色板，再对索引值进行LSBR
* **隐写原理**： 亮度序号奇偶性就是颜色的奇偶性，奇偶性代表了隐写值
* **缺陷**：亮度排序**不**准确，EzStego软件隐写后图片色彩有跳跃性

#### 基于距离排序的最佳奇偶分配（optimum parity assignment，OPA）的调色板隐写
* **OPA的作用**：使得$c_i$与最近距离$s_i$的奇偶性必定不同
* **颜色距离的定义**： $d[i,j]=d_{RGB} (c_i,c_j)=\sqrt{(r_i+r_j)^2+(g_i+g_j)^2+(b_i+b_j)^2}$
* **嵌入原理**：使用颜色三个分量和的奇偶性$P(c_i)=(r_i+g_i+b_i)mod 2$表示隐写消息的比特
* **OPA隐写原理** 
设调色颜色共有N个,令$P$={空},$c_i$奇偶性用$P(c_i)$（**0/1**分别代表二元奇偶性）表示。**（注意，$P$和$P(c_i)$不是一个东西，$P(c_i)$中是Parity）**
   1. 计算并排序全部$d[i,j]$，得到**非递减序列**(因为有相等距离存在)$D=\cdots d[u,v]\leq d[k,l]$，Notes：计算**N!**次；
   2. 得到**唯一序列D**。例如，对相等距离的d，按照颜色索引值大小进行排序。**Notes**：**递减**序列
   3. 因为是**非递减唯一序列**，从小的距离$d[i,j]$开始分配奇偶
      * $if c_i \notin P$集合且$c_j \notin P$集合，分配相反的奇偶性给$c_i$与$c_j$,$P集合=P\cup${$c_i$}$\cup${$c_j$}
      * $if c_i \notin P$集合且$c_j \in P$集合，则将$P(c_i)=1-P(c_j)$**（奇偶性相反，$P(c)$代表的是奇偶性！）**，$P集合=P\cup${$c_i$}
      * $if c_i \in P$集合且$c_j \notin P$集合，则将$P(c_j)=1-P(c_i)$，$P集合=P\cup${$c_j$}
   (因为从小距离开始，所以最短距离先分配)
### 总结2.4：距离排序相比于亮度排序更加准确，最佳奇偶分配OPA使得颜色$c_i$与最近距离的颜色奇偶性一定不同。
---
### 2.5量化调制与格（暂时略过）
---

## 第3章 隐写分布特性的保持

**统计特征保持**：隐写中**尽可能的维持**载体的**统计分布**，并非要求完全一致。（一般指一阶载体分布的保持，尚未出现一阶以上的载体分布保持）

---
## 3.1 $\chi$<sup>2</sup>统计量(针对识别LSBR)

**回顾第二章-LSBR特性**：奇值只减，偶值只加

*例*：$h(2i)$表示采样点$2i$的直方图值，$h^x(2i)$表示为隐写后的值。不失一般性，**因**$h(2i)>h^x(2i)$，**所以**更多$h(2i)$变成了$2i+1$。
$\Rightarrow|h(2i)-h(2i+1)|\geq|h^x(2i+1)-h^x(2i)|$  *(造成对值分布更接近的原因)*
**提示：**
$|h(2i)+h(2i+1)|=|h^x(2i+1)+h^x(2i)|$*(值对不**外流**)。如 011-010互相改变，但不失一般性，原始的010的数量比原始的011数量多，所以，更多010变成了011，较少的011变成了010，造成了值对 。$\Rightarrow$***教材P20 总有一个数量的增加多余减少*** 

---
**$\chi^2$表示**:服从$N(0,1)$高斯（正态）分布变量**平方和**的分币。

**记：**
+ $y^x(i)=(h^x(2i)+h^x(2i+1))/2;$
$y^x(i)$是**固定值**
+ $y(i)=h^x(2i)$ 
$y(i)$是**偶数修改后的值**

![](:https://github.com/hmzbox/Study-notes/blob/master/Stego/images/3.1t.png)


