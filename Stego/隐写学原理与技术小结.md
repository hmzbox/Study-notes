
## 第2章 图像编码与基本嵌入方法
---
### 2.1 RGB、YUV和YC<sub>b</sub>C<sub>r</sub>空域图像编码格式

**RGB(模型)**：RGB888是依据人眼识别的颜色定义出的空间。它的细节难以进行数字化的调整。

RGB的取值范围为：[0,255]、[0,255]、[0,255]

**YUV(模型)**: 
YUV的取值范围为：[0,255]、[负整数,正整数]、[负整数,正整数]
1. 相对于RGB，将亮度和色度分离开，从而适合于图像处理领域
2. 相对于RGB，兼容彩色电视与黑白电视问题，只有Y则是灰度图像。

**Y**表示**亮度(Luminance component/Luma)** Y = 0.299R + 0.587G + 0.114B，只有Y信号=**灰度图像**

**U、V**用来表示**色度(Chrominace/chroma)**，**U、V**是构成彩色的两个分量。

此时，我们设 U = 0.492(B - Y)，V=0.877(R-Y) 则可以求得：

U = - 0.147R- 0.289G + 0.436B　　V = 0.615R - 0.515G - 0.100B
即：

![](https://github.com/hmzbox/Study-notes/blob/master/Stego/images/YUV%20mode.png)

**YC<sub>b</sub>C<sub>r</sub>**: 为了统一YUV模型的取值范围为[0,255]

![](https://github.com/hmzbox/Study-notes/blob/master/Stego/images/YCbCr.png)


### 总结：YUV色彩模型来源于RGB模型，YCbCr模型来源于YUV模型，还未涉及压缩，压缩是JPEG通过YUV411或YUV422**采样**实现。YUV为分离亮度和色度，及实现黑白彩色电视兼容提出，YCbCr为改变YUV取值范围为[0,255]
---
### 2.2 JPEG 变换域图像编码
**有损压缩**

因人眼对亮度变换的敏感度要比对色彩变换的敏感度高出很多，所以，可以认为Y分量要比C<sub>b</sub>和C<sub>r</sub>分量重要的多。

通常采用两种采样方式：YUV411和YUV422，它们所代表的意义是Y,C<sub>b</sub>和C<sub>r</sub>三个分量的数据取样比例一般是4：1：1或者4：2：2（在2x2的单元中，本应分别有4个Y，4个U，4个V值，用**12**个字节存储。经4:1:1采样处理后，每个单元中的值分别有4个Y、1个U、1个V，只用**6**个字节。

![](https://github.com/hmzbox/Study-notes/blob/master/Stego/images/JPEG.png)

1. YC<sub>b</sub>C<sub>r</sub>格式输入。若输入不是YC<sub>b</sub>C<sub>r</sub>格式，则转换成YC<sub>b</sub>C<sub>r</sub>;
2. 图像切分成8×8和采样。若H和W不是8的倍数，则需要扩充到8的倍数（Y通常是嵌入域），并对C<sub>b</sub>和C<sub>r</sub>进行YUV411或YUV422采样；（例如16×16的块，包含4个Y分块和1个C<sub>b</sub>和1个C<sub>r</sub>）
3. DCT II变换。将输入分块均-128,范围 [0,255] 到 [-128,127] 以满足DCT输入条件（偶函数）；每个8×8分块都通过DCT II变换得到8×8的浮点数DCT系数矩阵 M<sub>dct</sub>（最左上角的点为直流系数DC，其余为交流系数AC）。
4. 量化=M<sub>dct</sub> / Q<sub>i</sub>，然后取整。通过质量因子QF(如80)选取8×8的量化表 Q<sub>i</sub>，QF的取值范围为（70-100）（新的量化后矩阵就会出现很多0）
5. 无损压缩。64个DCT矩阵排成一维序列，**DC部分**采用差分编码（DPCM）只记录相邻块的DC系数差，**AC系数部分**采用游程编码RLEC，最后将DPCM和RLEC进行熵编码，也就是哈夫曼编码(Huffman),最后加上头文件。
---
### 2.3 二元嵌入 LSBR（least significant bit replacement）与三元嵌入LSBM（LSB matching）

#### LSBR
* 应用：**Jsteg**隐写软件，在JPEG量化DCT系数采用LSBR
* 原理：**奇小偶大**，替换最小bit位，最小位若是0（**偶数**）变1（**+1**），最小位若是1（**奇数**）变0（**-1**）
* 缺陷：**值对**现象出现，使得相邻像素的值接近，如：2i与2i+1趋于相等，如图：
![](https://github.com/hmzbox/Study-notes/blob/master/Stego/images/LSBRHistogram.png)
* 优势：在JPEG量化系数-1、0、1不适用，通常最小值对是2与3、是-2与-3，**奇小偶大**可以使得1与2、-1与-2是最小值对，从分利用了分布较密的1与-1。
#### LSBM

* 提出原因：解决LSBR值对问题
* 原理：![](https://github.com/hmzbox/Study-notes/blob/master/Stego/images/LSBM.png)
如：2=(010)<sub>2</sub>，if s=0，不改变；if s=1，(010)<sub>2</sub>+1=(011)<sub>2</sub>=3 or (010)<sub>2</sub>-1=(001)<sub>2</sub>=1
* 性能分析：![](https://github.com/hmzbox/Study-notes/blob/master/Stego/images/LSBMHistogram.png)